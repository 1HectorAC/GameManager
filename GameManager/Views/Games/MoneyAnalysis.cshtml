@model IEnumerable<GameManager.Models.Game>

@{

    ViewBag.Title = "MoneyAnalysis";
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw==" crossorigin="anonymous"></script>


@if (ViewBag.Year == null)
{
    using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()
        <div class="row">
            <div class="col-md-6 col-md-offset-3 whiteCard text-center" style="padding: 10px; margin-top:10px">
                <h2>Money Analysis</h2>
                <hr class="greenLine" />
                <p>Select a year to analyze.</p>
                <div class="form-group">
                    <label class="control-label col-md-3 col-md-offset-1" for="SelectYear">Select Year</label>
                    <div class="col-md-6">
                        @Html.DropDownList("SelectYear", null, htmlAttributes: new { @class = "form-control" })
                        <span class="field-validation-valid text-danger" data-valmsg-for="SelectYear" data-valmsg-replace="true"></span>
                    </div>

                </div>

                <div class="form-group">
                    <div class=" col-md-12">
                        <br />
                        <input type="submit" value="Enter" class="btn customButton" />
                    </div>
                </div>
                <div class="col-md-12">
                    <p>Note: If you don't have any purchased games in your games List then you won't see any years to select. Go to games list @Html.ActionLink("here.", "Index", "Games")</p>
                </div>

            </div>
        </div>
    }
}
else
{
    <h2 class="whiteText" style="text-align:center">@ViewBag.Year Money Analysis</h2>
    <hr class="whiteLine" style="margin-bottom:10px" />
    <div class="row">

        <!--Monthly Cost chart.-->
        <div class="col-md-8">
            <!--Setup monthly cost related variable(costData) for chart setup in other js file.-->
            <script>
                var costData = new Array();
                var array = @Html.Raw(Json.Encode(@ViewBag.MonthlyCost));
                for(var i =0; i<array.length;i++){
                    costData[i] = array[i];
                }
            </script>
            <div class="whiteCard">
                <!--Canvas used to display the chart.-->
                <canvas id="costBarGraph" width="700" height="275" style="padding:10px"></canvas>
            </div>

        </div>

        <!--Total spent in year and total games played.-->
        <div class="col-md-4">
            <div class="whiteCard text-center" style="padding:10px;">
                <h3 style="margin-bottom:0px; padding-bottom:0px">Total Spent</h3>
                <h1 style="margin-top:0px; padding-top:0px">$@ViewBag.TotalSpent</h1>

                <h3 style="margin-bottom:0px; padding-bottom:0px">Total Games Played</h3>
                <h1 style="margin-top:0px; padding-top:0px">@ViewBag.TotalGames</h1>
                <h3 style="margin-bottom:0px; padding-bottom:0px">Average Spent per Game</h3>
                <h1 style="margin-top:0px; padding-top:0px">$@ViewBag.AverageSpentPerGame</h1>
            </div>
        </div>

        <!--Monthly spent numbers.-->
        <div class="col-md-6">
            <div class="whiteCard " style="padding:10px; margin-top:15px;line-height:12px">
                <h3 class="text-center">Monthly Count & Spending($)</h3>
                <div class="col-md-3">
                    @for (int i = 0; i < 6; i++)
                    {
                        <p class="text-right"><b>@ViewBag.Months[i]</b></p>
                    }
                </div>
                <div class="col-md-3">
                    @for (int i = 0; i < 6; i++)
                    {
                        <p>@ViewBag.MonthlyCount[i] ($@ViewBag.MonthlyCost[i])</p>
                    }
                </div>
                <div class="col-md-3">
                    @for (int i = 6; i < 12; i++)
                    {
                        <p class="text-right"><b>@ViewBag.Months[i]</b></p>
                    }
                </div>
                <div class="col-md-3">
                    @for (int i = 6; i < 12; i++)
                    {
                        <p>@ViewBag.MonthlyCount[i] ($@ViewBag.MonthlyCost[i])</p>
                    }
                </div>

                <p style="color:#f7f7f7; margin:0px; padding:0px">a</p>
            </div>
        </div>

        <!--Monthly count.-->
        <div class="col-md-6">
            <div class="whiteCard" style="padding:10px; margin-top:15px;line-height:12px">
                <h3 class="text-center">Price Range Analysis</h3>
                <div class="col-md-3">
                    @for (int i = 0; i < 5; i++)
                    {
                        <p class="text-right"><b>@ViewBag.PriceLabels[i]</b></p>
                    }
                </div>
                <div class="col-md-3">
                    @for (int i = 0; i < 5; i++)
                    {
                        <p class="text-left">@ViewBag.PriceRange[i]</p>
                    }
                </div>
                <div class="col-md-3">
                    @for (int i = 5; i < 10; i++)
                    {
                        <p class="text-right"><b>@ViewBag.PriceLabels[i]</b></p>
                    }
                </div>
                <div class="col-md-3">
                    @for (int i = 5; i < 10; i++)
                    {
                        <p class="text-left">@ViewBag.PriceRange[i]</p>
                    }
                </div>

                <p style="color:#f7f7f7; margin:0px; padding:0px">a</p>
            </div>
        </div>

        <!--Display game details.-->
        <div class="col-md-12">
            <div class="panel panel-default whiteCard" style="margin-top:15px;">
                <div class="panel-heading" style="text-align:center;line-height:.8">
                    <h3 style="margin:0px;">Games Purchased</h3>
                </div>

                <div class="panel-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Console</th>
                                <th>Price</th>
                                <th>Purchase Date</th>
                                <th>Physical Copy</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Title)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.SystemName)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Price)
                                    </td>
                                    <td>
                                        @item.DateOfPurchase.Value.ToShortDateString()
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Physical)
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script src="@Url.Content("~/Scripts/GraphSetup.js")" type="text/javascript"></script>
    <script>
        BarGraphSetup("costBarGraph","Monthly Spending Chart($)", ['Jan', 'Feb', 'March', 'April', 'May', 'June', 'July', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], costData);
    </script>
}
